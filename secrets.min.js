/*! secrets-passbolt 2022-08-19 */

!function(e,t){"use strict";if("function"==typeof define&&define.amd){var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};define([],function(){return e.secrets=t(r.crypto)})}else"object"==typeof exports?module.exports=t(require("crypto")):e.secrets=t(e.crypto)}(this,function(n){"use strict";var u,b,i,a,s;function h(){u={bits:8,radix:16,minBits:3,maxBits:20,bytesPerChar:2,maxBytesPerChar:6,primitivePolynomials:[null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83]},b={},i=new Array(1024).join("0"),a=!0,s=["nodeCryptoRandomBytes","browserCryptoGetRandomValues","testRandom"]}function f(){return!(!b||!b.rng||"function"!=typeof b.rng)}function g(e,t){var r;if(0===t||1===t)return e;if(t&&1024<t)throw new Error("Padding must be multiples of no larger than 1024 bits.");return t=t||b.bits,e&&(r=e.length%t),r?(i+e).slice(-(t-r+e.length)):e}function c(e){var t,r,n="";for(r=e.length-1;0<=r;r--){if(t=parseInt(e[r],16),isNaN(t))throw new Error("Invalid hex character.");n=g(t.toString(2),4)+n}return n}function m(e){var t,r,n="";for(r=(e=g(e,4)).length;4<=r;r-=4){if(t=parseInt(e.slice(r-4,r),2),isNaN(t))throw new Error("Invalid binary character.");n=t.toString(16)+n}return n}function o(){return!(!n||"object"!=typeof n||"function"!=typeof n.getRandomValues&&"object"!=typeof n.getRandomValues||"function"!=typeof Uint32Array&&"object"!=typeof Uint32Array)}function l(){return"object"==typeof n&&"function"==typeof n.randomBytes}function p(e){function a(e,t,r,n){var i,a=0,o="";for(t&&(i=t.length-1);a<i||o.length<e;)o+=g(Math.abs(parseInt(t[a],r)).toString(2),n),a++;return((o=o.substr(-e)).match(/0/g)||[]).length===o.length?null:o}function t(e){var t,r=null;for(16,4,t=Math.ceil(e/8);null===r;)r=a(e,n.randomBytes(t).toString("hex"),16,4);return r}function r(e){var t,r=null;for(10,32,t=Math.ceil(e/32);null===r;)r=a(e,n.getRandomValues(new Uint32Array(t)),10,32);return r}return e&&"testRandom"===e?(b.typeCSPRNG=e,function(e){var t,r,n=null;r=Math.ceil(e/32),t=new Uint32Array(r);for(var i=0;i<t.length;i++)t[i]=123456789;for(;null===n;)n=a(e,t,10,32);return n}):e&&"nodeCryptoRandomBytes"===e?(b.typeCSPRNG=e,t):e&&"browserCryptoGetRandomValues"===e?(b.typeCSPRNG=e,r):l()?(b.typeCSPRNG="nodeCryptoRandomBytes",t):o()?(b.typeCSPRNG="browserCryptoGetRandomValues",r):void 0}function d(e,t){var r,n=[];for(t&&(e=g(e,t)),r=e.length;r>b.bits;r-=b.bits)n.push(parseInt(e.slice(r-b.bits,r),2));return n.push(parseInt(e.slice(0,r),2)),n}function w(e,t){var r,n=b.logs[e],i=0;for(r=t.length-1;0<=r;r--)i=0!==i?b.exps[(n+b.logs[i])%b.maxShares]^t[r]:t[r];return i}function y(e,t,r){var n,i,a,o,s=0;for(a=0,n=t.length;a<n;a++)if(r[a]){for(i=b.logs[r[a]],o=0;o<n;o++)if(a!==o){if(e===t[o]){i=-1;break}i=(i+b.logs[e^t[o]]-b.logs[t[a]^t[o]]+b.maxShares)%b.maxShares}s=-1===i?s:s^b.exps[i]}return s}function x(e,t,r){var n,i,a=[],o=[e];for(n=1;n<r;n++)o[n]=parseInt(b.rng(b.bits),2);for(i=t+(n=1);n<i;n++)a[n-1]={x:n,y:w(n,o)};return a}function v(e,t,r){var n,i,a,o;if(t=parseInt(t,b.radix),n=(e=parseInt(e,10)||b.bits).toString(36).toUpperCase(),o=(a=Math.pow(2,e)-1).toString(b.radix).length,i=g(t.toString(b.radix),o),"number"!=typeof t||t%1!=0||t<1||a<t)throw new Error("Share id must be an integer between 1 and "+a+", inclusive.");return n+i+r}var e={init:function(e,t){var r,n,i=[],a=[],o=1;if(h(),e&&("number"!=typeof e||e%1!=0||e<u.minBits||e>u.maxBits))throw new Error("Number of bits must be an integer between "+u.minBits+" and "+u.maxBits+", inclusive.");if(t&&-1===s.indexOf(t))throw new Error("Invalid RNG type argument : '"+t+"'");for(b.radix=u.radix,b.bits=e||u.bits,b.size=Math.pow(2,b.bits),b.maxShares=b.size-1,r=u.primitivePolynomials[b.bits],n=0;n<b.size;n++)i[a[n]=o]=n,(o<<=1)>=b.size&&(o^=r,o&=b.maxShares);if(b.logs=i,b.exps=a,t&&this.setRNG(t),f()||this.setRNG(),!(f()&&b.bits&&b.size&&b.maxShares&&b.logs&&b.exps&&b.logs.length===b.size&&b.exps.length===b.size))throw new Error("Initialization failed.")},combine:function(e,t){var r,n,i,a,o,s,h,u="",f=[],l=[];for(t=t||0,r=0,i=e.length;r<i;r++){if(s=this.extractShareComponents(e[r]),void 0===o)o=s.bits;else if(s.bits!==o)throw new Error("Mismatched shares: Different bit settings.");if(b.bits!==o&&this.init(o),-1===f.indexOf(s.id))for(f.push(s.id),n=0,a=(h=d(c(s.data))).length;n<a;n++)l[n]=l[n]||[],l[n][f.length-1]=h[n]}for(r=0,i=l.length;r<i;r++)u=g(y(t,f,l[r]).toString(2))+u;return m(1<=t?u:u.slice(u.indexOf("1")+1))},getConfig:function(){var e={};return e.radix=b.radix,e.bits=b.bits,e.maxShares=b.maxShares,e.hasCSPRNG=f(),e.typeCSPRNG=b.typeCSPRNG,e},extractShareComponents:function(e){var t,r,n,i,a,o={};if((t=parseInt(e.substr(0,1),36))&&("number"!=typeof t||t%1!=0||t<u.minBits||t>u.maxBits))throw new Error("Invalid share : Number of bits must be an integer between "+u.minBits+" and "+u.maxBits+", inclusive.");if(i=Math.pow(2,t)-1,n=(Math.pow(2,t)-1).toString(b.radix).length,(a=new RegExp("^([a-kA-K3-9]{1})([a-fA-F0-9]{"+n+"})([a-fA-F0-9]+)$").exec(e))&&(r=parseInt(a[2],b.radix)),"number"!=typeof r||r%1!=0||r<1||i<r)throw new Error("Invalid share : Share id must be an integer between 1 and "+b.maxShares+", inclusive.");if(a&&a[3])return o.bits=t,o.id=r,o.data=a[3],o;throw new Error("The share data provided is invalid : "+e)},setRNG:function(e){var t="Random number generator is invalid ",r=" Supply an CSPRNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's.";if(e&&"string"==typeof e&&-1===s.indexOf(e))throw new Error("Invalid RNG type argument : '"+e+"'");if((e=e||p())&&"string"==typeof e&&(e=p(e)),a){if(e&&"function"!=typeof e)throw new Error(t+"(Not a function)."+r);if(e&&"string"!=typeof e(b.bits))throw new Error(t+"(Output is not a string)."+r);if(e&&!parseInt(e(b.bits),2))throw new Error(t+"(Binary string output not parseable to an Integer)."+r);if(e&&e(b.bits).length>b.bits)throw new Error(t+"(Output length is greater than config.bits)."+r);if(e&&e(b.bits).length<b.bits)throw new Error(t+"(Output length is less than config.bits)."+r)}return b.rng=e,!0},str2hex:function(e,t){var r,n,i,a,o,s,h="";if("string"!=typeof e)throw new Error("Input must be a character string.");if("number"!=typeof(t=t||u.bytesPerChar)||t<1||t>u.maxBytesPerChar||t%1!=0)throw new Error("Bytes per character must be an integer between 1 and "+u.maxBytesPerChar+", inclusive.");for(r=2*t,n=Math.pow(16,r)-1,o=0,s=e.length;o<s;o++){if(a=e[o].charCodeAt(),isNaN(a))throw new Error("Invalid character: "+e[o]);if(n<a)throw i=Math.ceil(Math.log(a+1)/Math.log(256)),new Error("Invalid character code ("+a+"). Maximum allowable is 256^bytes-1 ("+n+"). To convert this character, use at least "+i+" bytes.");h=g(a.toString(16),r)+h}return h},hex2str:function(e,t){var r,n,i,a="";if("string"!=typeof e)throw new Error("Input must be a hexadecimal string.");if("number"!=typeof(t=t||u.bytesPerChar)||t%1!=0||t<1||t>u.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+u.maxBytesPerChar+", inclusive.");for(n=0,i=(e=g(e,r=2*t)).length;n<i;n+=r)a=String.fromCharCode(parseInt(e.slice(n,n+r),16))+a;return a},random:function(e){if("number"!=typeof e||e%1!=0||e<2||65536<e)throw new Error("Number of bits must be an Integer between 1 and 65536.");return m(b.rng(e))},share:function(e,t,r,n){var i,a,o,s,h,u=new Array(t),f=new Array(t);if(n=n||128,"string"!=typeof e)throw new Error("Secret must be a string.");if("number"!=typeof t||t%1!=0||t<2)throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.");if(t>b.maxShares)throw i=Math.ceil(Math.log(t+1)/Math.LN2),new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive. To create "+t+" shares, use at least "+i+" bits.");if("number"!=typeof r||r%1!=0||r<2)throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.");if(r>b.maxShares)throw i=Math.ceil(Math.log(r+1)/Math.LN2),new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+b.maxShares+"), inclusive.  To use a threshold of "+r+", use at least "+i+" bits.");if(t<r)throw new Error("Threshold number of shares was "+r+" but must be less than or equal to the "+t+" shares specified as the total to generate.");if("number"!=typeof n||n%1!=0||n<0||1024<n)throw new Error("Zero-pad length must be an integer between 0 and 1024 inclusive.");for(o=0,h=(e=d(e="1"+c(e),n)).length;o<h;o++)for(a=x(e[o],t,r),s=0;s<t;s++)u[s]=u[s]||a[s].x.toString(b.radix),f[s]=g(a[s].y.toString(2))+(f[s]||"");for(o=0;o<t;o++)u[o]=v(b.bits,u[o],m(f[o]));return u},newShare:function(e,t){var r;if(e&&"string"==typeof e&&(e=parseInt(e,b.radix)),r=e.toString(b.radix),e&&r&&t&&t[0])return v(this.extractShareComponents(t[0]).bits,r,this.combine(t,e));throw new Error("Invalid 'id' or 'shares' Array argument to newShare().")},_reset:h,_padLeft:g,_hex2bin:c,_bin2hex:m,_hasCryptoGetRandomValues:o,_hasCryptoRandomBytes:l,_getRNG:p,_isSetRNG:f,_splitNumStringToIntArray:d,_horner:w,_lagrange:y,_getShares:x,_constructPublicShareString:v};return e.init(),e});